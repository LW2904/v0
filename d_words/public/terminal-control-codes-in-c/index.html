<!DOCTYPE html>
<html lang="en">
<head>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="A page containing, surprisingly, words.">
	<meta name="author" content="Me.">

	<link rel="icon" href="../static/favicon.png">
	<link rel="stylesheet" href="../static/css/markdown.css">
	<link rel="stylesheet" href="../static/css/highlighting.css">

	<title>Terminal Control Codes in C</title>
</head>
<body>
	<div class="markdown-body">
		<h1>Terminal Control Codes in C</h1>

		<p>Many terminals (and terminal emulators) support color and cursor control through a system of escape sequences. A commonly supported and used standard is often referred to as "ANSI Colour", on which the VT100 terminal specification which we will be using is based.
</p>
<p>A terminal control code is a special sequence of characters that is sent to <code class="prettyprint">stdout</code> (like any other text). If the terminal understands the code it won't display the sequence, but will perform the action which correlates to the code.
</p>
<p>As an example, the code which can be used to erase the screen looks like <code class="prettyprint">&lt;ESC&gt; [ 2J</code> where <code class="prettyprint">&lt;ESC&gt;</code> represents the ASCII escape character, 27. Spaces are ignored, and can be added for increased readability.
</p>
<p>A more or less complete list of these sequences can be found on <a href="http://www.termsys.demon.co.uk/vtansi.htm#status">termsys.demon.co.uk</a>, but I'll explain the codes used here as we go along.
</p>
<p>Now, the title says "in C", so here goes:
</p>
<p>```c
#include <stdio.h>
</p>
<p>#define ASCII_ESC 27
</p>
<p>int main()
{
    setbuf(stdout, NULL);
</p>
<pre class="prettyprint"><code>printf("%c[2J", ASCII_ESC);
</code></pre><pre class="prettyprint"><code>return 0;
</code></pre><p>}
```
</p>
<p>The above snippet uses the code which was already introduced as an example to clear the screen; its behavior is very similar to the <code class="prettyprint">CTRL + L</code> shortcut in bash.
</p>
<p>A very important statement to note is the call to <code class="prettyprint">setbuf()</code> in line 7, which disables buffering for stdout.
</p>
<p>Having these control codes strewn about in code can only be considered a bad practice, so we're always going to write abstractions for them. This will help readability and make the code cleaner, not to speak of the fact that remembering and always typing these codes out in full can get very annoying, very quickly.
</p>
<p>One such abstraction, which will come in very handy in the next few examples, could be called <code class="prettyprint">move_cursor()</code>.
</p>
<p><code class="prettyprint">`c
void move_cursor(int x, int y)
{
	printf("%c[%d;%dH", ASCII_ESC, y, x);
}
</code>`
</p>
<p>The control code to move the cursor naturally has to accept arguments in the form of line and column numbers, which are passed directly after the <code class="prettyprint">[</code> and seperated by semicolons. Note that the control code is defined as <code class="prettyprint">[{row};{column}H</code>, which is why we first pass <code class="prettyprint">y</code>, followed by <code class="prettyprint">x</code>. The arguments to <code class="prettyprint">move_cursor()</code> could also be called <code class="prettyprint">line</code> and <code class="prettyprint">column</code>, but I've found <code class="prettyprint">x</code> and <code class="prettyprint">y</code> to be more intuitive, not to speak of them being much quicker to type.
</p>
<p>In combination with basic stdio functions we can do a great many things with <code class="prettyprint">move_cursor()</code>. For example, drawing a line could be done with the following function.
</p>
<p>```c
void draw<em>line(int slope, int width)
{
	for (int i = 0; i &lt; width; i++) {
		move</em>cursor(i, (slope <em> -1) </em> i);
</p>
<pre class="prettyprint"><code>putchar('#');
</code></pre><p>}
}
```
</p>
<p>The possibilities are endless, and I don't feel like it would add much value if I would provide more examples here - for an example use case (and implementation) do feel free to read through the code of <a href="https://github.com/LW2904/vt-space">vt-space</a>, a 2D space shooter in the terminal.
</p>

	</div>

</body>

</html>
